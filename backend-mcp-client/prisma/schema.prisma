generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model GraphProject {
  id               String       @id @default(cuid())
  name             String
  description      String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  conversationId   String       @unique
  conversationName String
  edges            GraphEdge[]
  nodes            GraphNode[]
  states           GraphState[]

  @@map("graph_projects")
}

model GraphNode {
  id        String
  label     String
  type      String
  data      String
  position  String
  createdAt DateTime     @default(now())
  graphId   String
  graph     GraphProject @relation(fields: [graphId], references: [id], onDelete: Cascade)

  @@id([id, graphId])
  @@unique([id, graphId])
  @@map("graph_nodes")
}

model GraphEdge {
  id        String       @id @default(cuid())
  source    String
  target    String
  label     String?
  type      String?
  data      String?
  createdAt DateTime     @default(now())
  graphId   String
  graph     GraphProject @relation(fields: [graphId], references: [id], onDelete: Cascade)

  @@map("graph_edges")
}

model GraphState {
  id        String       @id @default(cuid())
  snapshot  String
  command   String
  timestamp DateTime     @default(now())
  graphId   String
  graph     GraphProject @relation(fields: [graphId], references: [id], onDelete: Cascade)

  @@map("graph_states")
}
